{% include 'header.html' %}

<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" class="prism-dark" disabled />

<main>
    <article class="post-content">
        <header class="post-header">
            <h1 class="post-title">{{ post.title }}</h1>
            {% if post.image %}
            <div class="post-image">
                <img src="../images/{{ post.image }}" alt="{{ post.title }}">
            </div>
            {% endif %}
            <div class="post-meta">
                <span class="post-date">Published on: {{ post.date.strftime('%Y-%m-%d') }}</span>
                <span class="post-categories">Categories: 
                    {% for category in post.categories %}
                    <a href="../{{ generate_category_url(category) }}">{{ category }}</a>{% if not loop.last %}, {% endif %}
                    {% endfor %}
                </span>
            </div>
            <div class="post-tags">
                Tags: {% for tag in post.tags %}
                <a href="../{{ generate_tag_url(tag) }}" class="tag-link">{{ tag }}</a>{% if not loop.last %}, {% endif %}
                {% endfor %}
            </div>
        </header>
        
        {{ post.content | safe }}
         <!-- Previous/Next Navigation -->
        {% set prev_post = None %}
        {% set next_post = None %}

        {% for p in posts %}
            {% if p.date < post.date and (prev_post is none or p.date > prev_post.date) and post.categories[0] == p.categories[0] %}
                {% set prev_post = p %}
            {% endif %}
             {% if p.date > post.date and (next_post is none or p.date < next_post.date) and post.categories[0] == p.categories[0] %}
                 {% set next_post = p %}
            {% endif %}
        {% endfor %}

        <nav class="post-navigation">
            {% if prev_post %}
                <a href="../{{ generate_post_url(prev_post) }}">« Previous: {{ prev_post.title }}</a>
            {% endif %}
            {% if next_post %}
                <a href="../{{ generate_post_url(next_post) }}">Next: {{ next_post.title }} »</a>
            {% endif %}
        </nav>
    </article>
</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
<script>
    // Toggle Prism theme based on dark mode
    function updatePrismTheme() {
        const isDark = document.body.classList.contains('dark-theme');
        document.querySelector('.prism-dark').disabled = !isDark;
    }
    
    // Initial theme setup
    updatePrismTheme();
    
    // Watch for theme changes
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.attributeName === 'class') {
                updatePrismTheme();
            }
        });
    });
    
    observer.observe(document.body, {
        attributes: true
    });
</script>

{% include 'footer.html' %}